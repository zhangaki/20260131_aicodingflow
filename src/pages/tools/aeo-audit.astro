---
import BaseHead from '../../components/BaseHead.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';

export const prerender = false;

const pageTitle = "AI Visibility & GEO Checker | ChatGPT SEO Optimization Tool";
const pageDesc = "Audit your website for the AI era. Check your visibility in ChatGPT, Perplexity, and Claude. Optimize your content for Generative Engine Optimization (GEO).";
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={pageTitle} description={pageDesc} />
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
        
        <style is:global>
            :root {
                --bg-dark: #000206;
                --bg-panel: #050a14;
                --primary: #3b82f6;
                --primary-glow: rgba(59, 130, 246, 0.5);
                --success: #00f0ff; /* Cyberpunk Cyan */
                --success-glow: rgba(0, 240, 255, 0.5);
                --warning: #facc15;
                --danger: #ff0055;
                --text-main: #ffffff;
                --text-muted: #94a3b8;
                --border: rgba(255, 255, 255, 0.08);
                --glass: rgba(10, 15, 30, 0.6);
            }

            body {
                background-color: var(--bg-dark);
                background-image: 
                    linear-gradient(rgba(59, 130, 246, 0.05) 1px, transparent 1px),
                    linear-gradient(90deg, rgba(59, 130, 246, 0.05) 1px, transparent 1px);
                background-size: 50px 50px;
                color: var(--text-main);
                font-family: 'Outfit', sans-serif;
            }

            main { 
                width: 100% !important; 
                max-width: 100% !important; 
                margin: 0 !important; 
                padding: 0 !important; 
                min-height: 100vh;
                display: flex;
                flex-direction: column;
            }

            .dashboard-container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 8rem 2rem 4rem;
                width: 100%;
                flex: 1;
            }

            /* Typography */
            h1, h2, h3 { font-weight: 700; letter-spacing: -0.02em; }
            .mono { font-family: 'JetBrains Mono', monospace; }

            /* Landing Hero */
            .landing {
                text-align: center;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                min-height: 60vh;
                position: relative;
            }
            .landing::before {
                content: '';
                position: absolute;
                width: 600px;
                height: 600px;
                background: radial-gradient(circle, rgba(59, 130, 246, 0.15) 0%, transparent 70%);
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                z-index: -1;
                pointer-events: none;
            }
            .hero-badge {
                padding: 0.5rem 1rem;
                background: rgba(59, 130, 246, 0.1);
                border: 1px solid rgba(59, 130, 246, 0.3);
                border-radius: 100px;
                color: var(--primary);
                font-size: 0.85rem;
                font-weight: 500;
                margin-bottom: 2rem;
                box-shadow: 0 0 20px rgba(59, 130, 246, 0.2);
            }
            .landing h1 {
                font-size: 4rem;
                line-height: 1.1;
                margin-bottom: 1.5rem;
                background: linear-gradient(135deg, #fff 0%, #90baff 100%);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                text-shadow: 0 0 30px rgba(59, 130, 246, 0.3);
            }
            .landing p {
                font-size: 1.25rem;
                color: var(--text-muted);
                max-width: 600px;
                margin-bottom: 3rem;
                line-height: 1.6;
            }

            /* Search Terminal */
            .search-wrapper {
                width: 100%;
                max-width: 700px;
                position: relative;
            }
            .search-box {
                background: rgba(10, 15, 30, 0.8);
                backdrop-filter: blur(20px);
                border: 1px solid var(--border);
                border-radius: 20px;
                padding: 0.5rem;
                display: flex;
                box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.5);
                transition: all 0.3s ease;
            }
            .search-box:focus-within {
                border-color: var(--primary);
                box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2), 0 20px 40px -10px rgba(0, 0, 0, 0.5);
            }
            .search-icon {
                display: flex;
                align-items: center;
                justify-content: center;
                width: 50px;
                color: var(--text-muted);
            }
            .search-box input {
                flex: 1;
                background: transparent;
                border: none;
                color: #fff;
                font-size: 1.1rem;
                outline: none;
                padding: 1rem 0;
                font-family: 'Outfit', sans-serif;
            }
            .search-box input::placeholder { color: rgba(148, 163, 184, 0.5); }
            .analyze-btn {
                background: var(--primary);
                color: #fff;
                border: none;
                border-radius: 14px;
                padding: 0 2rem;
                font-weight: 600;
                font-size: 1rem;
                cursor: pointer;
                transition: all 0.2s;
                position: relative;
                overflow: hidden;
            }
            .analyze-btn:hover {
                background: #2563eb;
                box-shadow: 0 0 20px rgba(59, 130, 246, 0.4);
            }
            .analyze-btn::after {
                content: '';
                position: absolute;
                top: 0; left: -100%;
                width: 100%; height: 100%;
                background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
                transition: 0.5s;
            }
            .analyze-btn:hover::after { left: 100%; }

            /* Results Dashboard */
            #results { display: none; opacity: 0; transition: opacity 0.5s; }
            #results.visible { opacity: 1; }

            .dashboard-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 3rem;
                padding-bottom: 1rem;
                border-bottom: 1px solid var(--border);
            }
            .target-url {
                display: flex;
                align-items: center;
                gap: 1rem;
                font-size: 0.9rem;
                color: var(--text-muted);
            }
            .url-badge {
                background: rgba(255, 255, 255, 0.05);
                padding: 0.5rem 1rem;
                border-radius: 8px;
                color: var(--success);
                border: 1px solid rgba(0, 240, 255, 0.2);
            }

            /* Metrics Grid */
            .metrics-grid {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 2rem;
                margin-bottom: 4rem;
            }
            .metric-card {
                background: var(--glass);
                border: 1px solid var(--border);
                border-radius: 24px;
                padding: 2.5rem 2rem;
                display: flex;
                flex-direction: column;
                align-items: center;
                position: relative;
                overflow: hidden;
                transition: transform 0.3s, box-shadow 0.3s;
            }
            .metric-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 30px -10px rgba(0,0,0,0.5);
            }
            .metric-card::before {
                content: '';
                position: absolute;
                top: 0; left: 0; width: 100%; height: 4px;
                background: var(--border);
            }
            .metric-card.score-high::before { background: var(--success); box-shadow: 0 2px 10px var(--success-glow); }
            .metric-card.score-med::before { background: var(--warning); }
            .metric-card.score-low::before { background: var(--danger); box-shadow: 0 2px 10px rgba(255, 0, 85, 0.5); }

            /* Modern Gauge */
            .gauge-wrapper {
                width: 140px;
                height: 140px;
                position: relative;
                margin-bottom: 1.5rem;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            /* Background circle */
            .gauge-bg {
                position: absolute;
                width: 100%;
                height: 100%;
                border-radius: 50%;
                border: 8px solid rgba(255, 255, 255, 0.05);
            }
            
            /* SVG styling */
            .gauge-svg {
                width: 100%;
                height: 100%;
                transform: rotate(-90deg);
                filter: drop-shadow(0 0 8px currentColor);
            }
            .gauge-circle-fg {
                fill: none;
                stroke-width: 8;
                stroke-linecap: round;
                transition: stroke-dashoffset 1.5s cubic-bezier(0.2, 0.8, 0.2, 1);
            }
            
            /* Center Value */
            .gauge-value-container {
                position: absolute;
                display: flex;
                flex-direction: column;
                align-items: center;
            }
            .gauge-number {
                font-size: 2.5rem;
                font-weight: 700;
                line-height: 1;
                font-family: 'JetBrains Mono', monospace;
            }
            .gauge-max { font-size: 0.8rem; opacity: 0.5; margin-top: 2px; }

            .metric-title { font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem; }
            .metric-desc { font-size: 0.85rem; color: var(--text-muted); text-align: center; }

            /* Audit List */
            .audit-section { margin-top: 2rem; }
            .section-title { font-size: 1.5rem; margin-bottom: 2rem; display: flex; align-items: center; gap: 1rem; }
            .section-title::after { content: ''; flex: 1; height: 1px; background: var(--border); }

            .audit-card {
                background: rgba(255, 255, 255, 0.02);
                border: 1px solid var(--border);
                border-radius: 12px;
                overflow: hidden;
                margin-bottom: 1rem;
                transition: all 0.3s;
            }
            .audit-card:hover { 
                background: rgba(255, 255, 255, 0.04); 
                border-color: rgba(255, 255, 255, 0.15);
            }
            .audit-card.open { border-color: var(--primary); background: rgba(59, 130, 246, 0.05); }

            .audit-header {
                padding: 1.25rem 1.5rem;
                display: flex;
                align-items: flex-start;
                gap: 1.25rem;
                cursor: pointer;
            }
            .status-dot {
                width: 12px; height: 12px;
                border-radius: 50%;
                margin-top: 6px;
                flex-shrink: 0;
            }
            .status-pass { background: var(--success); box-shadow: 0 0 10px var(--success-glow); }
            .status-fail { background: var(--danger); box-shadow: 0 0 10px rgba(255, 0, 85, 0.4); }
            .status-warn { background: var(--warning); box-shadow: 0 0 10px rgba(250, 204, 21, 0.4); }

            .audit-summary { flex: 1; }
            .audit-name { font-weight: 600; margin-bottom: 0.25rem; font-size: 1.05rem; }
            .audit-preview { font-size: 0.9rem; color: var(--text-muted); }

            .expand-icon {
                color: var(--text-muted);
                transition: transform 0.3s;
            }
            .audit-card.open .expand-icon { transform: rotate(180deg); color: var(--primary); }

            .audit-body {
                display: none;
                padding: 0 1.5rem 1.5rem 4rem;
                animation: slideDown 0.3s ease-out;
            }
            .audit-card.open .audit-body { display: block; }

            .detail-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 1.5rem;
                margin-top: 1rem;
            }
            .info-box {
                background: rgba(0, 0, 0, 0.3);
                border-radius: 12px;
                padding: 1.25rem;
                border: 1px solid var(--border);
            }
            .info-label { 
                font-size: 0.75rem; 
                text-transform: uppercase; 
                color: var(--text-muted); 
                letter-spacing: 0.05em; 
                margin-bottom: 0.75rem;
                display: block;
            }
            .info-text { font-size: 0.95rem; line-height: 1.6; color: #e2e8f0; }

            .code-block {
                margin-top: 1.5rem;
                background: #0d1117;
                border: 1px solid var(--border);
                border-radius: 12px;
                position: relative;
            }
            .code-header {
                padding: 0.75rem 1rem;
                border-bottom: 1px solid var(--border);
                display: flex;
                justify-content: space-between;
                align-items: center;
                background: rgba(255,255,255,0.02);
            }
            .code-lang { font-size: 0.8rem; color: var(--text-muted); font-weight: 600; }
            .copy-btn {
                background: transparent;
                border: none;
                color: var(--primary);
                font-size: 0.8rem;
                font-weight: 500;
                cursor: pointer;
            }
            .copy-btn:hover { text-decoration: underline; color: #fff; }

            .code-content {
                padding: 1rem;
                overflow-x: auto;
                font-family: 'JetBrains Mono', monospace;
                font-size: 0.85rem;
                color: #a5d6ff;
                line-height: 1.6;
            }

            @keyframes slideDown {
                from { opacity: 0; transform: translateY(-10px); }
                to { opacity: 1; transform: translateY(0); }
            }

            /* Loading State */
            .loader-overlay {
                display: none;
                position: fixed;
                inset: 0;
                background: rgba(3, 7, 18, 0.9);
                backdrop-filter: blur(10px);
                z-index: 1000;
                flex-direction: column;
                align-items: center;
                justify-content: center;
            }
            .cyber-spinner {
                width: 60px;
                height: 60px;
                border: 3px solid transparent;
                border-top-color: var(--primary);
                border-right-color: var(--success);
                border-radius: 50%;
                animation: spin 1s linear infinite;
                margin-bottom: 1.5rem;
                box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
            }
            .scanning-text {
                font-family: 'JetBrains Mono', monospace;
                font-size: 1rem;
                color: var(--primary);
                animation: pulse 2s infinite;
            }
            @keyframes spin { 100% { transform: rotate(360deg); } }
            @keyframes pulse { 50% { opacity: 0.5; } }

            @media (max-width: 800px) {
                .landing h1 { font-size: 2.5rem; }
                .metrics-grid { grid-template-columns: 1fr; }
                .detail-grid { grid-template-columns: 1fr; }
                .audit-body { padding-left: 1.5rem; }
            }
        </style>
	</head>
	<body>
		<Header />
		
        <main>
            <div class="dashboard-container">
                
                <!-- Landing View -->
                <div class="landing" id="landing">
                    <div class="hero-badge">âœ¨ AI-First SEO Analysis</div>
                    <h1>Is your site ready for<br>the AI Era?</h1>
                    <p>Audit your content's visibility in Large Language Models. Get actionable insights to rank in ChatGPT, Claude, and Perplexity.</p>
                    
                    <div class="search-wrapper">
                        <div class="search-box">
                            <div class="search-icon">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><path d="M21 21l-4.35-4.35"></path></svg>
                            </div>
                            <input type="url" id="urlInput" placeholder="https://example.com/blog/article-1" onkeydown="if(event.key==='Enter')runAudit()" />
                            <button class="analyze-btn" id="analyzeBtn" onclick="runAudit()">Audit Content</button>
                        </div>
                    </div>
                </div>

                <!-- Results Dashboard -->
                <div id="results">
                    <div class="dashboard-header">
                        <div>
                            <button onclick="location.reload()" style="background:none; border:none; color:var(--text-muted); cursor:pointer; font-size:0.9rem; margin-bottom:0.5rem; display:flex; align-items:center; gap:0.5rem;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5"/><path d="M12 19l-7-7 7-7"/></svg>
                                Back to Search
                            </button>
                            <h2 style="margin:0;">Audit Report</h2>
                        </div>
                        <div class="target-url">
                            <span>Target:</span>
                            <span class="url-badge mono" id="resultUrl">...</span>
                        </div>
                    </div>

                    <!-- Top Metrics Grid -->
                    <div class="metrics-grid" id="metricsGrid">
                        <!-- Template for JS to populate -->
                    </div>

                    <!-- Detailed Audit List -->
                    <div class="audit-section" id="auditList">
                        <!-- JS populated -->
                    </div>
                </div>

            </div>
        </main>

        <Footer />

        <!-- Loading Overlay -->
        <div class="loader-overlay" id="loader">
            <div class="cyber-spinner"></div>
            <div class="scanning-text">INITIALIZING NEURAL HANDSHAKE...</div>
        </div>

        <script is:inline>
            // Utility
            const esc = (t) => t ? t.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;') : '';
            function toggleCard(id) { document.getElementById(id).classList.toggle('open'); }
            
            function copyToClipboard(text, btn) {
                navigator.clipboard.writeText(text);
                const original = btn.textContent;
                btn.textContent = "COPIED!";
                setTimeout(() => btn.textContent = original, 2000);
            }

            // Metric Card Template
            function createMetricCard(title, score, max, desc, id) {
                const percentage = (score / max) * 100;
                let statusClass = 'score-low';
                let color = 'var(--danger)';
                
                if (percentage >= 80) { statusClass = 'score-high'; color = 'var(--success)'; }
                else if (percentage >= 50) { statusClass = 'score-med'; color = 'var(--warning)'; }

                // SVG Circumference for dashoffset
                const r = 60;
                const circ = 2 * Math.PI * r;
                const offset = circ - (percentage / 100) * circ;

                return `
                    <div class="metric-card ${statusClass}">
                        <div class="gauge-wrapper">
                            <div class="gauge-bg"></div>
                            <svg class="gauge-svg" viewBox="0 0 140 140" style="color: ${color}">
                                <circle class="gauge-circle-fg" cx="70" cy="70" r="${r}" 
                                    stroke="currentColor" fill="none"
                                    stroke-dasharray="${circ}" stroke-dashoffset="${offset}" />
                            </svg>
                            <div class="gauge-value-container">
                                <span class="gauge-number" style="color: ${color}">${score}</span>
                                <span class="gauge-max">/${max}</span>
                            </div>
                        </div>
                        <div class="metric-title">${title}</div>
                        <div class="metric-desc">${desc}</div>
                    </div>
                `;
            }

            // Audit Row Template
            function createAuditRow(item, index) {
                const statusMap = { 'pass': 'status-pass', 'warning': 'status-warn', 'fail': 'status-fail' };
                const rowId = `audit-${index}`;
                
                return `
                    <div class="audit-card" id="${rowId}">
                        <div class="audit-header" onclick="toggleCard('${rowId}')">
                            <div class="status-dot ${statusMap[item.status] || 'status-fail'}"></div>
                            <div class="audit-summary">
                                <div class="audit-name">${esc(item.name)}</div>
                                <div class="audit-preview">${esc(item.details).substring(0, 80)}...</div>
                            </div>
                            <svg class="expand-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
                        </div>
                        <div class="audit-body">
                            <div class="detail-grid">
                                <div class="info-box">
                                    <span class="info-label">Observation</span>
                                    <div class="info-text">${esc(item.details)}</div>
                                </div>
                                <div class="info-box">
                                    <span class="info-label">Recommendation</span>
                                    <div class="info-text">${esc(item.advice)}</div>
                                </div>
                            </div>
                            
                            ${item.developerPrompt ? `
                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-lang">QUICK FIX</span>
                                        <button class="copy-btn" onclick="copyToClipboard(\`${(item.fixCode || item.developerPrompt).replace(/`/g, '\\\\`')}\`, this)">COPY CODE</button>
                                    </div>
                                    <div class="code-content">${esc(item.fixCode || item.developerPrompt)}</div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }

            // Main Logic
            async function runAudit() {
                const input = document.getElementById('urlInput');
                const btn = document.getElementById('analyzeBtn');
                const loader = document.getElementById('loader');
                const landing = document.getElementById('landing');
                const results = document.getElementById('results');
                const loadingText = loader.querySelector('.scanning-text');

                const url = input.value.trim();
                if (!url) return;

                // Loading Sequence
                loader.style.display = 'flex';
                btn.disabled = true;
                
                const texts = [
                    "ESTABLISHING CONNECTION...",
                    "PARSING DOM STRUCTURE...",
                    "SIMULATING LLM CRAWL...",
                    "ANALYZING SEMANTIC DENSITY...",
                    "GENERATING REPORT..."
                ];
                let textIdx = 0;
                const textInterval = setInterval(() => {
                    loadingText.textContent = texts[textIdx % texts.length];
                    textIdx++;
                }, 800);

                try {
                    const res = await fetch(`/api/analyze?url=${encodeURIComponent(url)}`);
                    const data = await res.json();
                    
                    clearInterval(textInterval);

                    if (data.error) throw new Error(data.error);

                    // Hydrate Data
                    document.getElementById('resultUrl').textContent = data.url;

                    // 1. Metrics
                    const metricsHtml = [
                        createMetricCard('Machine Access', data.categoryScores.machine, data.categoryMaxScores.machine, 'Can AI bots crawl and render your page?'),
                        createMetricCard('Knowledge Density', data.categoryScores.knowledge, data.categoryMaxScores.knowledge, 'Is your content structured for LLM retention?'),
                        createMetricCard('Entity Graph', data.categoryScores.graph, data.categoryMaxScores.graph, 'Are entities clearly defined and linked?')
                    ].join('');
                    document.getElementById('metricsGrid').innerHTML = metricsHtml;

                    // 2. Audit List
                    const auditHtml = data.checks.map((item, i) => createAuditRow(item, i)).join('');
                    document.getElementById('auditList').innerHTML = `<div class="section-title">Detailed Findings</div>` + auditHtml;

                    // Transition
                    loader.style.display = 'none';
                    landing.style.display = 'none';
                    results.style.display = 'block';
                    
                    // Trigger fade in
                    setTimeout(() => results.classList.add('visible'), 50);

                } catch (e) {
                    clearInterval(textInterval);
                    loader.style.display = 'none';
                    alert("Analysis Failed: " + e.message);
                } finally {
                    btn.disabled = false;
                }
            }
        </script>
	</body>
</html>
